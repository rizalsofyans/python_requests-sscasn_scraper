import requests
import pandas as pd

url = 'https://api-sscasn.bkn.go.id/2024/portal/spf'

headers = {
    'Accept': 'application/json, text/plain, */*',
    'Accept-Language': 'en-US,en;q=0.9,id;q=0.8',
    'Connection': 'keep-alive',
    'Origin': 'https://sscasn.bkn.go.id',
    'Referer': 'https://sscasn.bkn.go.id/',
    'Sec-Fetch-Dest': 'empty',
    'Sec-Fetch-Mode': 'cors',
    'Sec-Fetch-Site': 'same-site',
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36',
    'sec-ch-ua': '"Chromium";v="128", "Not;A=Brand";v="24", "Google Chrome";v="128"',
    'sec-ch-ua-mobile': '?0',
    'sec-ch-ua-platform': '"macOS"'
}

kode_ref_pend_list = ['5193674', '5193683', '5193677', '5193679', '5193675', '5193678', '5193682', '5193680', '7199921', '5191065', '4210021', '5210136', '5126000', '5157011', '5101026', '9400211', '5104811', '5100380', '5157010', '5100935', '5126013', '5102667', '7101489', '5210314', '5102273', '5126090', '5100045', '5210315', '5126050', '5193226', '5140100', '5140111', '5119078', '5192780', '5106188', '5102737', '5191196', '5101687', '5192615', '5101769', '5100718', '5009026', '5190332', '5100137', '5210316', '9940609', '5193560', '5106060', '5100013', '5210005', '5191115', '5210317', '5101427', '5100412', '5200070', '5193323', '5119079', '5119080', '7609118', '5100319', '5101201', '5192595', '5100830', '5100167', '5102257', '5192685', '5193667', '5193463', '5100890', '5120600', '5120631', '5120632', '5106445', '5193324', '5120613', '5119157', '5100139', '5193501', '5109751', '5102463', '5193464', '5107510', '5210008', '5210108', '5120411', '5120231', '5109954', '5120532', '5210109', '5120321', '5101377', '5210110', '5102794', '5210194', '5210195', '5210200', '5210189', '5102795', '5210202', '5102738', '5210203', '5100858', '5210204', '5210205', '5210206', '5100952', '5192622', '5110814', '5192613', '5120213', '5120523', '5120112', '5120512', '5120211', '5120311', '5120552', '5120331', '5210111', '5191423', '5102753', '5120522', '5120542', '5120221', '5119082', '5193561', '5110937', '5100852', '5109952', '5200061', '5100012', '5210140', '5210141', '5107221', '5210545', '5159000', '5159012', '5106572', '5102770', '5119085', '5200115', '5210207', '5191374', '5210010', '5100129', '5210012', '5210208', '5100200', '5210209', '5210210', '5191125', '5106462', '5106351', '5106511', '5106512', '5106141', '5193191', '5193642', '5210014', '5192789', '5140216', '5192764', '5191104', '5210323', '5119030', '5119036', '5119031', '5210324', '5102809', '5119035', '5191126', '5100072', '5009002', '5104201', '5193039', '5210016', '5101775', '5101269', '5191187', '5101430', '5210211', '5101417', '5102394', '5101116', '5101118', '5101113', '5140319', '5101122', '5101270', '5101300', '5101231', '5210017', '5190061', '5101112', '5102541', '5101115', '5190098', '5101720', '5100552', '9400226', '5210560', '5191157', '5101117', '5102812', '5190100', '5100650', '5104849', '5191131', '5100289', '5104400', '5102467', '5103120', '5210606', '5102367', '5102396', '5154000', '5140116', '5154038', '5140217', '5107280', '5210327', '5192740', '5210021', '5104503', '5119027', '5190076', '5107230', '5160000', '5100010', '5160015', '5100736', '5210561', '5100517', '5190037', '5102310', '5100296', '5101761', '5199998', '5104505', '5100069', '5106166', '5192706', '5100453', '5100073', '5106186', '5190229', '5192799', '5123000', '5123110', '5123344', '5101447', '5102759', '5123331', '5191292', '5100845', '5123500', '5101890', '5191094', '5123317', '5102653', '5193334', '5191095', '5123450', '5102554', '5200040', '5171001', '5190038', '5126019', '5126015', '5126017', '5100219', '5193051', '5100217', '5102475', '9400286', '5210196', '9940610', '5119091', '5210214', '5100436', '5210215', '5192798', '5101293', '5100780', '5190104', '5103139', '5119146', '5101202', '5102548', '5190135', '5191158', '5100162', '5101203', '5193709', '5100155', '500942', '5102519', '5100205', '5104911', '5106191', '5210024', '5100519', '5106168', '5180002', '5123130', '5210337', '5100237', '5103072', '5180001', '5100259', '5192611', '5100377', '5100154', '5193056', '5009008', '5210546', '5101927', '5105020', '5101947', '5192668', '5100928', '5193057', '5103138', '5104501', '5191018', '5102477', '5101186', '5100747', '5100483', '5131002', '5190020', '5191410', '5101794', '5150001', '5193060', '9940611', '5153000', '5192686', '5100840', '5200005', '5119094', '5193618', '5193400', '5190183', '5100466', '5100269', '5193689', '5100221', '5100735', '5193522', '5100592', '5103137', '5210216', '5119147', '5144001', '5210338', '5110900', '6202387', '5193063', '5103136', '5100378', '5191239', '5180000', '5190017', '5193692', '5192573', '5100157', '5145082', '5193064', '5119148', '5100370', '5120704', '5106160', '5190182', '5145013', '5145004', '5192598', '5100199', '5193488', '5105030', '5100782', '5193066', '5193382', '5193639', '5102479', '5100327', '5100135', '5100373', '5193350', '5191141', '5191381', '5210217', '5210339', '5101765', '5190044', '5153001', '5119149', '5199990', '5192710', '5210218', '5210219', '5210220', '5210221', '5193069', '5210222', '5102932', '5210223', '5210224', '5210225', '5210226', '5210227', '5210228', '5210229', '5210230', '5102934', '5210231', '5210232', '5210233', '5193077', '5210031', '5193078', '5192804', '5210032', '5210340', '5210568', '5180005', '5210033', '5104700', '5210341', '5100048', '5102576', '5100104', '9400025', '5101043', '5104152', '5104153', '5104200', '5101289', '5210235', '5104110', '5100759', '5101302', '5101305', '5100904', '5192814', '5107900', '5131030', '5107911', '5104500', '5190120', '5104800', '5193590', '5193351', '5104820', '5101047', '5131001', '5210601', '5210608', '7609178', '5210602', '5210609', '5210346', '5210604', '5100520', '5193534', '5210547', '5210034', '5101309', '5146001', '5190050', '5100635', '5010145', '5100956', '5102482', '5101350', '5107211', '5100478', '5193407', '5150000', '5191068', '5100770', '5150022', '5150041', '5101272', '5100826', '5140322', '5103157', '5153021', '5191391', '5153050', '5153041', '5103135', '5101511', '5191389', '5191133', '5210036', '5210236', '5210237', '5210238', '5210239', '5210037', '5191207', '5100757', '5101512', '5192786', '5100847', '5191087', '5193089', '5190122', '5210112', '5210190', '5191361', '5210241', '5102955', '5210038', '5102286', '5193211', '5102918', '5100813', '5100601', '5210349', '5193093', '5193094', '5210550', '5119110', '5102607', '5101317', '5193095', '5210350', '5109943', '5119111', '5210351', '5102606', '5106310', '5190067', '5101505', '5102960', '5150023', '5101325', '5101323', '5210359', '5191380', '5104841', '5111111', '5101328', '5210569', '5191079', '5103134', '5210353', '5210242', '5102962', '5101268', '5100071', '5210360', '5110671', '5110672', '5109920', '5192697', '5210355', '5210356', '5199994', '5103140', '5102485', '5101316', '5210358', '5102742', '5100832', '5210570', '5101329', '5210562', '5102750', '5210243', '5101320', '5101310', '5191099', '5190206', '5101050', '5193408', '5193536', '5102303', '5193105', '5106121', '5100136', '5210525', '5190083', '5107241', '5100590', '7609179', '5100019', '5193640', '5191379', '5107100', '5101553', '5210563', '5192763', '5191135', '5101353', '5191185', '5100553', '5210044', '5193641', '5191286', '5190084', '5100467', '5210122', '5109251', '5109731', '5102752', '5109900', '9940566', '5210045', '5199997', '5192811', '5100751', '5210361', '5193354', '5210046', '5102357', '5102489', '5192783', '5193537', '5101438', '5210599', '5210598', '5210607', '5210363', '5106177', '5110000', '5110360', '5100066', '5102281', '5140219', '5110625', '5110965', '5110464', '5110800', '5110822', '5100664', '5210113', '5190070', '5100778', '5110813', '5110851', '5110816', '5101057', '5110812', '5101597', '5110852', '5110817', '5110862', '5110872', '5100110', '5193524', '5210114', '5110882', '5210115', '5110891', '5101606', '5101607', '5210048', '5110932', '5110160', '5110970', '5210244', '5100634', '5009013', '5111002', '5110633', '5100943', '5110993', '5102318', '5191071', '5102078', '5210366', '5101725', '5191438', '5110122', '5190045', '5190111', '5190219', '5110967', '5193298', '5102660', '5119139', '5102656', '5119140', '5100079', '5210245', '5131050', '5110652', '5100091', '5110140', '5111000', '5110634', '5193468', '5101652', '5102672', '5102493', '5100120', '5191234', '5101817', '5110991', '5110120', '5191278', '5193545', '5102673', '5210246', '5110964', '5191163', '5111003', '5101653', '5210369', '5210370', '5210371', '5110811', '5210247', '5110462', '5192771', '5102550', '5190041', '5110380', '5102572', '5110554', '5102494', '5100728', '5110212', '5110231', '5110232', '5110219', '5191117', '5102495', '5110221', '5110224', '5192810', '5111050', '6202433', '5102573', '5100618', '5102715', '5102978', '5102979', '5102716', '5102986', '9940612', '5210248', '5210249', '5210250', '5210251', '5102993', '5102994', '5102989', '5102718', '5210252', '5102988', '5102983', '5210372', '5210373', '5191295', '5210133', '5100087', '5210566', '5101669', '5101670', '5100232', '5191064', '5199314', '5106551', '5106106', '5210571', '5193620', '5193414', '5190043', '5101518', '5210375', '5101575', '5210376', '5210377', '5210378', '5140221', '5102193', '5102496', '5191396', '5192809', '5210253', '5101682', '5192768', '5193361', '5193525', '5210052', '5101683', '5100672', '5109169', '5210445', '5100389', '5153100', '5106500', '5193481', '5190213', '5106563', '5102904', '5192576', '5106200', '5100480', '5210379', '5102907', '5192638', '5101577', '9000700', '5193727', '5193123', '5101578', '5109170', '5192633', '5106100', '5191040', '5106137', '5210053', '5106112', '5102053', '5190071', '5192625', '5193363', '5191078', '5100400', '5101579', '5199316', '5102497', '5193644', '5210381', '5100374', '5106411', '5100612', '5130000', '5101950', '5100459', '5191382', '5130011', '5193127', '5100121', '5200114', '5130012', '5100115', '5130032', '5102888', '5193181', '5193224', '7609175', '5193599', '5210255', '5210256', '5210257', '5210258', '5210259', '5193301', '5210384', '5210058', '5210059', '5210260', '6202280', '5210060', '5100197', '5119120', '5210061', '5210385', '5193131', '5210261', '5209124', '5210262', '5210263', '5210264', '5210555', '5210062', '5210063', '5103063', '5210265', '5210064', '5210197', '5210267', '5210065', '5210386', '5210268', '5210066', '5210269', '5210270', '5210271', '5100717', '5210272', '5210273', '5210274', '5210067', '5193132', '5210275', '5193302', '5210276', '5210387', '5102648', '5210277', '5200120', '5210278', '5210279', '5210068', '5210280', '5210069', '5210281', '5210282', '5190014', '5210283', '5210388', '5210284', '5210165', '5210166', '5100895', '5199321', '5210070', '5210071', '5210285', '5210072', '5102872', '5210286', '5210287', '5210288', '5210289', '5102388', '5102544', '5210389', '5210290', '5210390', '5210291', '5210292', '5210294', '5210295', '5210296', '5151051', '4609140', '5101083', '5100828', '5101271', '5190069', '5100044', '5210116', '5120412', '5120414', '5100637', '5100982', '5120232', '5102500', '5120531', '5210297', '5120322', '5120200', '5100055', '5120100', '5102160', '5120212', '5120215', '5120312', '5120551', '5120332', '5102501', '5120111', '5120117', '5120521', '5120541', '5100406', '5120222', '5102868', '5120703', '5102502', '5100105', '5192760', '5210298', '5126100', '5119000', '5119052', '5119021', '5119012', '5119061', '5119073', '5100235', '5119014', '5119019', '5119041', '5191138', '5199317', '5210299', '5192767', '5100112', '5100144', '5210394', '5191413', '5150070', '5210533', '5193636', '5150072', '5130031', '5193418', '5190009', '5106594', '5106480', '5100047', '5100523', '5140323', '5145000', '5190129', '5145081', '5192559', '5100550', '5100317', '5151000', '5151020', '5151001', '5102757', '5151050', '5102615', '5210300', '5193552', '5210395', '5192610', '5210078', '5210301', '5210302', '5210303', '9940614', '5210079', '5210572', '5100967', '5119127', '6202401', '5119128', '5102517', '6202354', '5100053', '5193368', '5193369', '5100064', '5102508', '5101068', '5193370', '5102618', '5193371', '5192762', '5200000', '6202402', '5103162', '5193374', '5102756', '5109700', '5100070', '5101345', '9940618', '5210398', '5191367', '5103117', '5102511', '5102358', '5210177', '5210082', '5102552', '5102368', '5210399', '5191063', '5191097', '5109711', '5190093', '5100624', '5102362', '5190099', '5109716', '5100927', '5192781', '5210400', '5190002', '5109795', '5109781', '5109923', '5191405', '5109791', '5192769', '5009031', '5101087', '5100970', '5210304', '5210178', '5210305', '5102103', '5109601', '5210084', '5210558', '5210306', '5107216', '5101346', '5009032', '5191287', '5210307', '5109785', '5109790', '5193154', '5193155', '5109797', '5100746', '5193290', '5109730', '5100551', '5192812', '5109000', '5210308', '5101805', '5109770', '5210402', '5190184', '5102391', '5110218', '5109168', '5100268', '5100825', '5100376', '5109167', '5109760', '5210181', '5109789', '5109788', '5106187', '5193637', '5190033', '5210403', '5210404', '5210405', '5210182', '5109100', '5191402', '5191209', '5102012', '5210406', '5193527', '5210407', '5210183', '5192820', '5193616', '5210309', '5109715', '5100031', '5193389', '5100944', '5210184', '5193163', '5103009', '5106537', '5106538', '5106330', '5192785', '5106536', '5103014', '5106120', '5101841', '5106433', '5210310', '5193164', '5106117', '5190068', '5100036', '5103018', '5210410', '5109202', '5100581', '5190089', '5104814', '5104815', '5101877', '5100001', '5110946', '5191375', '5210542', '5106240', '5106111', '5100015', '5102711', '5210411', '5102542', '5210412', '5192784', '5210091', '5210092', '5210573', '5210095', '5210097', '5191351', '5102661', '5119132', '5210099', '5190227', '5101534', '5190001', '5109502', '5210311', '6202229', '5209106', '5100285', '5100283', '5209110', '5209112', '7609237', '5209115', '5100302', '5209119']

def fetch_all_data(url, headers, params):
    all_data = []
    while True:
        response = requests.get(url, headers=headers, params=params)

        if response.status_code != 200:
            print(f"Request failed with status code {response.status_code}")
            break

        try:
            data = response.json()
        except ValueError:
            print("Failed to parse JSON response")
            break

        # print("API Response:", data['data'])

        if 'data' in data and 'data' in data['data']:
            data_list = data['data']['data']
        else:
            print("Unexpected response structure:", data)
            break

        if not data_list:
            break

        all_data.extend(data_list)

        params['offset'] += len(data_list)

    return all_data

final_data = []

for kode in kode_ref_pend_list:
    print(f"Fetching data for kode_ref_pend: {kode}")
    params = {
        'kode_ref_pend': kode,
        'offset': 0
    }
    data = fetch_all_data(url, headers, params)
    final_data.extend(data)

df = pd.DataFrame(final_data)

df.to_json('data_sscasn_all_jurusan.json', orient='records')

df.to_excel('data_sscasn_all_jurusan.xlsx')

print("Exported to 'data_sscasn_all_jurusan.json' & 'data_sscasn_all_jurusan.xlsx'")
